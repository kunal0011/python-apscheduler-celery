[tox]
requires =
    tox>=4
    tox-uv>=1.0.0
env_list = py310, py311, py312, lint, type

[testenv]
description = Run unit tests with pytest
runner = uv-venv-runner
deps =
    pytest>=7.4.4
    pytest-asyncio>=0.23.3
    pytest-cov>=4.1.0
    pytest-mock>=3.12.0
    aiosqlite>=0.19.0
    httpx>=0.26.0
commands =
    pytest tests/unit/ -v --tb=short {posargs}

[testenv:integration]
description = Run integration tests
runner = uv-venv-runner
deps =
    {[testenv]deps}
commands =
    pytest tests/integration/ -v --tb=short {posargs}

[testenv:all]
description = Run all tests with coverage
runner = uv-venv-runner
deps =
    {[testenv]deps}
commands =
    pytest tests/ -v --cov=app --cov-report=term-missing --cov-report=html {posargs}

[testenv:lint]
description = Run linters (ruff, black)
runner = uv-venv-runner
skip_install = true
deps =
    ruff>=0.1.13
    black>=24.1.0
commands =
    ruff check app/ tests/
    black --check app/ tests/

[testenv:format]
description = Format code with black and ruff
runner = uv-venv-runner
skip_install = true
deps =
    ruff>=0.1.13
    black>=24.1.0
commands =
    black app/ tests/
    ruff check --fix app/ tests/

[testenv:type]
description = Run type checking with mypy
runner = uv-venv-runner
deps =
    mypy>=1.8.0
    types-redis
commands =
    mypy app/ --ignore-missing-imports

[testenv:dev]
description = Development environment with all dependencies
runner = uv-venv-runner
deps =
    {[testenv]deps}
    ruff>=0.1.13
    black>=24.1.0
    mypy>=1.8.0
    pre-commit>=3.6.0
commands =
    python -c "print('Development environment ready!')"
